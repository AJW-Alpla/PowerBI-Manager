<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALPLA - Power BI Rights Manager</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 160.43 30" class="header-logo">
                <path d="M133.91,17.52l4.46-7.65h0l4.46,7.65ZM84.58,12.75H80V7.86h4.54c2.51,0,4.54,1.1,4.54,2.45s-2,2.45-4.54,2.45m-67,4.77,4.46-7.65h0l4.46,7.65Zm142.46,8.16h0L144,2.1h0C143.09.84,140.86,0,138.37,0s-4.72.84-5.59,2.1h0L119.31,21.82h-8.12V3.21c0-1.77-2.66-3.21-6-3.21s-6,1.44-6,3.21v2.4C96.55,2.28,91,0,84.58,0H74.09c-3.29,0-6,1.44-6,3.21V23.8a7.39,7.39,0,0,0-5.36-2h-8.2V3.21c0-1.77-2.67-3.21-6-3.21s-6,1.44-6,3.21V24.1l-15-22h0C26.78.84,24.55,0,22.06,0s-4.73.84-5.59,2.1h0L.37,25.68h0A2,2,0,0,0,0,26.79C0,28.56,2.67,30,6,30c2.6,0,4.9-.91,5.68-2.25l1.82-3.11H30.67l1.82,3.11c.78,1.34,3.08,2.25,5.68,2.25a7.71,7.71,0,0,0,5.23-1.68A7.7,7.7,0,0,0,48.63,30H62.78a7.09,7.09,0,0,0,5.61-2.28c.74,1.32,3,2.28,5.7,2.28,3.29,0,6-1.44,6-3.21V20.61h4.54c6.41,0,12-2.28,14.71-5.61V26.79c0,1.77,2.67,3.21,6,3.21h17c2.6,0,4.9-.91,5.68-2.25l1.82-3.11H147l1.82,3.11c.78,1.34,3.08,2.25,5.68,2.25,3.29,0,6-1.44,6-3.21a2,2,0,0,0-.37-1.11" fill="#004d90"/>
            </svg>
            <div class="header-content">
                <h1>Power BI Rights Manager</h1>
                <p>Manage workspace permissions and user access</p>
            </div>
        </div>
        
        <div class="auth-section">
            <span id="authStatus" class="status-badge not-authenticated">‚ö†Ô∏è Not Authenticated</span>
            <button onclick="showManualTokenModal()" style="background: linear-gradient(135deg, #0078d4 0%, #106ebe 100%);">
                <span style="display: inline-flex; align-items: center; gap: 8px;">
                    <svg width="16" height="16" viewBox="0 0 21 21"><rect x="1" y="1" width="9" height="9" fill="#f25022"/><rect x="1" y="11" width="9" height="9" fill="#00a4ef"/><rect x="11" y="1" width="9" height="9" fill="#7fba00"/><rect x="11" y="11" width="9" height="9" fill="#ffb900"/></svg>
                    Sign in with Power BI
                </span>
            </button>
            <button onclick="signOut()" id="signOutBtn" class="button-secondary" style="display: none;">Sign out</button>

            <div style="display: flex; gap: 10px; margin-left: auto;">
                <button id="workspaceViewBtn" onclick="switchView('workspace')" class="view-toggle active">
                    üìÅ Workspace View
                </button>
                <button id="userViewBtn" onclick="switchView('user')" class="view-toggle">
                    üë§ User View
                </button>
                <button id="adminViewBtn" onclick="switchView('admin')" class="view-toggle" style="display: none;">
                    üîß Admin Panel
                </button>
            </div>
        </div>
        
        <!-- WORKSPACE VIEW -->
        <div id="workspaceView">
            <div style="padding: 30px; border-bottom: 1px solid #e0e0e0;">
                <h2>üìÅ Workspace User Manager</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    Enter a workspace name to see and manage all users
                </p>
                <div style="max-width: 600px;">
                    <div style="display: flex; gap: 10px; position: relative;">
                        <div style="flex: 1; position: relative;">
                            <input type="text" id="workspaceSearch"
                                   placeholder="üìÅ Enter workspace name (e.g., Sales Reports)"
                                   style="width: 100%;" disabled
                                   oninput="showWorkspaceSuggestions()"
                                   onkeypress="if(event.key === 'Enter') { hideWorkspaceSuggestions(); searchWorkspace(); }"
                                   onfocus="showWorkspaceSuggestions()"
                                   autocomplete="off">
                            <div id="workspaceSuggestions" class="user-search-dropdown" style="display: none;"></div>
                        </div>
                        <button onclick="searchWorkspace()" class="button-success" id="searchWorkspaceBtn" disabled>Search</button>
                    </div>
                    <p style="font-size: 12px; color: #666; margin-top: 8px;">
                        üí° Start typing to see matching workspaces
                    </p>
                </div>
                <div id="selectedWorkspaceInfo" style="display: none; margin-top: 15px; padding: 15px; background: #e7f3ff; border-radius: 6px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>Selected Workspace:</strong> <span id="selectedWorkspaceName"></span>
                            <span style="margin-left: 15px; color: #666; font-size: 14px;">
                                üë• <span id="workspaceUserCount">0</span> user(s)
                            </span>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="refreshCurrentWorkspace()" class="button-primary" title="Refresh workspace users (F5)">
                                üîÑ Refresh
                            </button>
                            <button onclick="showBackupModal()" class="button-success" title="Backup workspace reports and datasets">
                                üì¶ Backup Workspace
                            </button>
                            <button onclick="clearWorkspaceSelection()" class="button-secondary">Change Workspace</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="pendingChangesContainer" class="pending-changes" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: start;">
                    <div style="flex: 1;">
                        <div style="font-weight: 700; color: #ff6b00; margin-bottom: 10px;">
                            ‚ö†Ô∏è <span id="pendingChangesCount">0</span> Pending Changes
                        </div>
                        <div id="pendingChangesList" style="max-height: 150px; overflow-y: auto; font-size: 13px;"></div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="applyPendingRoleChanges()" class="button-success">‚úì Apply</button>
                        <button onclick="cancelPendingRoleChanges()" class="button-secondary">‚úó Cancel</button>
                    </div>
                </div>
            </div>
            
            <div style="padding: 30px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 id="workspaceInfo">Users & Permissions</h3>
                    <button onclick="showAddUserModal()" class="button-success" id="addUserBtn" style="display: none;">
                        ‚ûï Add User
                    </button>
                </div>
                
                <!-- Bulk Actions Bar -->
                <div id="workspaceBulkActions" style="display: none; gap: 10px; padding: 15px; background: #fff3e6;
                     border: 2px solid #ff6b00; border-radius: 6px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;">
                    <span id="selectedUsersCount" style="font-weight: 600; color: #ff6b00;">0 selected</span>
                    <button onclick="bulkSetRole('Admin')">Set Admin</button>
                    <button onclick="bulkSetRole('Member')">Set Member</button>
                    <button onclick="bulkSetRole('Contributor')">Set Contributor</button>
                    <button onclick="bulkSetRole('Viewer')">Set Viewer</button>
                    <button onclick="bulkRemoveUsers()" class="button-danger">Remove from Selected</button>
                </div>

                <!-- Group Permissions Warning -->
                <div id="groupPermissionsWarning" style="display: none; padding: 12px 15px; background: #e7f3ff;
                     border-left: 4px solid #0078d4; border-radius: 4px; margin-bottom: 20px;">
                    <div style="display: flex; align-items: start; gap: 10px;">
                        <span style="font-size: 20px;">‚ÑπÔ∏è</span>
                        <div style="flex: 1;">
                            <strong style="color: #0078d4;">Group-Based Permissions Detected</strong>
                            <p style="margin: 5px 0 0 0; font-size: 13px; color: #555;">
                                This workspace has groups with Admin/Member permissions. You don't have direct user access,
                                but if you're a member of these groups, you may have permissions. Actions are enabled to allow
                                group-based access - the PowerBI API will validate your actual permissions when you perform actions.
                            </p>
                        </div>
                    </div>
                </div>

                <table id="usersTable">
                    <thead>
                        <tr>
                            <th class="checkbox-cell"><input type="checkbox" onchange="toggleSelectAll(this.checked)"></th>
                            <th>User</th>
                            <th>Email</th>
                            <th>Current Role</th>
                            <th>Assign Role</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="userTableBody">
                        <tr><td colspan="6" class="empty-state">
                            <div style="padding: 40px;">
                                <div style="font-size: 48px; margin-bottom: 15px;">üìÅ</div>
                                <p>Enter a workspace name above to view and manage users</p>
                            </div>
                        </td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- USER VIEW -->
        <div id="userView" style="display: none;">
            <div style="padding: 30px; border-bottom: 1px solid #e0e0e0;">
                <h2>üë§ User & Group Workspace Manager</h2>
                <p style="color: #666; margin-bottom: 20px;">
                    Enter a user's email or group name to see and manage all their workspace access
                </p>
                <div style="max-width: 900px;">
                    <div style="display: flex; gap: 10px; position: relative;">
                        <div style="flex: 1; position: relative;">
                            <input type="text" id="userViewEmailInput"
                                   placeholder="üìß Enter user email or group name (e.g., john.doe@company.com or BI-Global-Admin)"
                                   style="width: 100%;"
                                   oninput="showUserSuggestions()"
                                   onkeypress="if(event.key === 'Enter') { hideUserSuggestions(); searchUserByEmail(); }"
                                   onfocus="showUserSuggestions()"
                                   autocomplete="off">
                            <div id="userSuggestions" class="user-search-dropdown" style="display: none; min-width: 500px;"></div>
                        </div>
                        <button onclick="searchUserByEmail()" class="button-success">Search</button>
                    </div>
                    <p style="font-size: 12px; color: #666; margin-top: 8px;">
                        üí° Start typing to see users and groups from loaded workspaces
                    </p>
                </div>
                <div id="selectedUserPanel" style="display: none; margin-top: 15px; padding: 15px; background: #e7f3ff; border-radius: 6px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1;">
                            <strong>Selected User:</strong> <span id="selectedUserPanelName"></span>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                <span id="selectedUserPanelEmail"></span> ‚Ä¢ <strong id="workspaceCount">0</strong> workspaces
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button onclick="refreshCurrentUser()" class="button-primary" title="Refresh user workspaces (F5)">
                                üîÑ Refresh
                            </button>
                            <button onclick="clearUserSelection()" class="button-secondary">Change User</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="userWorkspacesContainer" style="display: none; padding: 30px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>Workspace Access</h3>
                    <button onclick="showAddWorkspaceAccessModal()" class="button-success" id="addWorkspaceAccessBtn">
                        ‚ûï Add Workspace Access
                    </button>
                </div>
                
                <!-- Bulk Actions Bar (Top Position) -->
                <div id="userBulkActions" style="display: none; gap: 10px; padding: 15px; background: #fff3e6; 
                     border: 2px solid #ff6b00; border-radius: 6px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;">
                    <span id="selectedWorkspacesCount" style="font-weight: 600; color: #ff6b00;">0 selected</span>
                    <button onclick="bulkChangeUserRole('Admin')">Set Admin</button>
                    <button onclick="bulkChangeUserRole('Member')">Set Member</button>
                    <button onclick="bulkChangeUserRole('Contributor')">Set Contributor</button>
                    <button onclick="bulkChangeUserRole('Viewer')">Set Viewer</button>
                    <button onclick="bulkRemoveUserFromWorkspaces()" class="button-danger">Remove from Selected</button>
                </div>
                
                <table>
                    <thead>
                        <tr>
                            <th class="checkbox-cell"><input type="checkbox" onchange="toggleAllUserWorkspaces(this.checked)"></th>
                            <th>Workspace Name</th>
                            <th>Current Role</th>
                            <th>Type</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="userWorkspacesTable">
                        <tr><td colspan="5" class="empty-state">
                            <div style="padding: 40px;">
                                <div style="font-size: 48px; margin-bottom: 15px;">üë§</div>
                                <p>Enter a user email above to view their workspace access</p>
                            </div>
                        </td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ADMIN VIEW (Power BI Administrators Only) -->
    <div id="adminView" style="display: none;">
        <div style="padding: 30px; background: #fff3cd; border-bottom: 3px solid #ffc107;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <span style="font-size: 32px;">‚ö†Ô∏è</span>
                <div>
                    <h2 style="color: #856404; margin-bottom: 5px;">üîß Power BI Administrator Panel</h2>
                    <p style="color: #856404; margin: 0;">
                        You have elevated privileges. Changes affect the entire organization.
                    </p>
                </div>
            </div>
        </div>

        <!-- Admin Mode Selector -->
        <div style="padding: 30px; border-bottom: 1px solid #e0e0e0;">
            <div style="display: flex; gap: 10px;">
                <button id="adminModeWorkspaceBtn" onclick="switchAdminMode('workspace')" class="view-toggle active">
                    üìÅ Assign Users to Workspace
                </button>
                <button id="adminModeUserBtn" onclick="switchAdminMode('user')" class="view-toggle">
                    üë§ Assign Workspaces to User
                </button>
            </div>
        </div>

        <!-- Help Section -->
        <div style="padding: 15px 20px; background: #e7f3ff; margin: 20px 20px 0 20px; border-radius: 6px; border-left: 4px solid #004d90;">
            <details style="cursor: pointer;">
                <summary style="font-weight: 600; color: #004d90; margin-bottom: 5px;">‚ÑπÔ∏è About Admin Panel (click to expand)</summary>
                <ul style="margin: 10px 0 0 20px; line-height: 1.6; color: #333; font-size: 13px;">
                    <li><strong>Workspace Mode:</strong> Select a workspace and add multiple users/groups to it</li>
                    <li><strong>User Mode:</strong> Select a user/group and add them to multiple workspaces</li>
                    <li><strong>Scope:</strong> You can manage ANY workspace in the organization</li>
                </ul>
            </details>
        </div>

        <!-- Admin Mode: Assign Users to Workspace -->
        <div id="adminAssignToWorkspace" style="background: white;">
            <div style="padding: 30px; border-bottom: 2px solid #e0e0e0; background: #f8f9fa;">
                <h3 style="color: #004d90; margin-bottom: 10px;">üìÅ Step 1: Select Workspace</h3>
                <p style="color: #666; margin-bottom: 15px; font-size: 13px;">
                    Search from all organizational workspaces (admin access)
                </p>
                <div style="position: relative;">
                    <input type="text" id="adminWorkspaceSearch"
                           placeholder="üîç Type workspace name to search..."
                           oninput="showAdminWorkspaceSuggestions()"
                           onfocus="showAdminWorkspaceSuggestions()"
                           autocomplete="off"
                           style="width: 100%; max-width: 600px; padding: 14px 20px; border: 2px solid #004d90; border-radius: 8px; font-size: 15px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <div id="adminWorkspaceSuggestions" class="user-search-dropdown" style="display: none;"></div>
                </div>
                <div id="adminSelectedWorkspaceInfo" style="display: none; margin-top: 15px; padding: 15px; background: #d4edda; border-radius: 6px; border: 2px solid #28a745;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong style="color: #155724;">‚úì Selected Workspace:</strong> <span id="adminSelectedWorkspaceName" style="color: #155724; font-weight: 600;"></span>
                        </div>
                        <button onclick="refreshCurrentAdminWorkspace()" class="button-success" title="Refresh workspace users (F5)" style="padding: 8px 16px; font-size: 13px;">
                            üîÑ Refresh
                        </button>
                    </div>
                </div>
            </div>

            <div style="padding: 30px; background: white;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #004d90;">üë• Step 2: Add Users/Groups</h3>
                    <button onclick="showAdminBulkAddModal()" class="button-success" id="adminBulkAddBtn" style="display: none;">
                        ‚ûï Add Multiple Users/Groups
                    </button>
                </div>
                <div id="adminAssignUsersPlaceholder" class="empty-state" style="background: #f8f9fa; border: 2px dashed #ccc; border-radius: 8px;">
                    <div style="padding: 50px; text-align: center;">
                        <div style="font-size: 64px; margin-bottom: 15px; opacity: 0.3;">üë•</div>
                        <p style="color: #666; font-size: 15px;">Select a workspace above to assign users/groups</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Mode: Assign Workspaces to User -->
        <div id="adminAssignToUser" style="display: none; background: white;">
            <div style="padding: 30px; border-bottom: 2px solid #e0e0e0; background: #f8f9fa;">
                <h3 style="color: #004d90; margin-bottom: 10px;">üë§ Step 1: Select User or Group</h3>
                <p style="color: #666; margin-bottom: 15px; font-size: 13px;">
                    Enter user email or group name
                </p>
                <div style="position: relative;">
                    <input type="text" id="adminUserSearch"
                           placeholder="üîç Type user email or group name to search..."
                           oninput="showAdminUserSuggestions()"
                           onfocus="showAdminUserSuggestions()"
                           autocomplete="off"
                           style="width: 100%; max-width: 600px; padding: 14px 20px; border: 2px solid #004d90; border-radius: 8px; font-size: 15px; background: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    <div id="adminUserSuggestions" class="user-search-dropdown" style="display: none;"></div>
                </div>
                <div id="adminSelectedUserInfo" style="display: none; margin-top: 15px; padding: 15px; background: #d4edda; border-radius: 6px; border: 2px solid #28a745;">
                    <strong style="color: #155724;">‚úì Selected:</strong> <span id="adminSelectedUserName" style="color: #155724; font-weight: 600;"></span>
                </div>
            </div>

            <div style="padding: 30px; background: white;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #004d90;">üìÅ Step 2: Add to Workspaces</h3>
                    <button onclick="showAdminBulkWorkspaceModal()" class="button-success" id="adminBulkWorkspaceBtn" style="display: none;">
                        ‚ûï Add to Multiple Workspaces
                    </button>
                </div>
                <div id="adminAssignWorkspacesPlaceholder" class="empty-state" style="background: #f8f9fa; border: 2px dashed #ccc; border-radius: 8px;">
                    <div style="padding: 50px; text-align: center;">
                        <div style="font-size: 64px; margin-bottom: 15px; opacity: 0.3;">üìÅ</div>
                        <p style="color: #666; font-size: 15px;">Select a user/group above to assign workspaces</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sign In Modal -->
    <div class="modal" id="authModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîê Sign in to Power BI</h2>
            </div>
            <div class="modal-body">
                <div style="padding: 15px; background: #e3f2fd; border-radius: 6px; margin-bottom: 20px; border: 1px solid #2196f3;">
                    <p style="color: #1565c0; font-size: 13px;">
                        <strong>Step 1:</strong> Run this command in PowerShell (opens Microsoft login):
                    </p>
                </div>
                <div style="background: #1e1e1e; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                    <code id="psCommand" style="display: block; color: #9cdcfe; font-family: 'Cascadia Code', Consolas, monospace; font-size: 12px; white-space: pre-wrap; line-height: 1.6; cursor: pointer;"
                          onclick="copyPowerShellCommand()" title="Click to copy">if (-not (Get-Module -ListAvailable -Name MicrosoftPowerBIMgmt)) { Write-Host "PowerBI module not found. Installing..." -ForegroundColor Yellow; Install-Module -Name MicrosoftPowerBIMgmt -Scope CurrentUser -Force }; Connect-PowerBIServiceAccount; (Get-PowerBIAccessToken).Authorization.Replace("Bearer ","") | Set-Clipboard; Write-Host "Token copied!" -ForegroundColor Green</code>
                    <button onclick="copyPowerShellCommand()" style="margin-top: 10px; font-size: 11px; padding: 5px 10px;">üìã Copy Command</button>
                </div>
                <div style="padding: 15px; background: #e8f5e9; border-radius: 6px; margin-bottom: 20px; border: 1px solid #4caf50;">
                    <p style="color: #2e7d32; font-size: 13px;">
                        <strong>Step 2:</strong> After signing in, the token is copied. Paste it below:
                    </p>
                </div>
                <div class="form-group">
                    <label>Access Token:</label>
                    <textarea id="manualToken" placeholder="Paste token here (Ctrl+V)..."
                              style="min-height: 100px; font-family: monospace; font-size: 11px;"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="closeAuthModal()" class="button-secondary">Cancel</button>
                <button onclick="authenticateWithToken()" class="button-success">‚úÖ Sign In</button>
            </div>
        </div>
    </div>
    
    <!-- Add User Modal -->
    <div class="modal" id="addUserModal">
        <div class="modal-content">
            <div class="modal-header"><h2>‚ûï Add User/Group</h2></div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Search User or Group</label>
                    <div style="position: relative;">
                        <input type="text" id="newUserEmail"
                               placeholder="Start typing user email or group name..."
                               oninput="showAddUserSuggestions()"
                               onfocus="showAddUserSuggestions()"
                               autocomplete="off">
                        <div class="user-search-dropdown" id="addUserSuggestions" style="display: none;"></div>
                    </div>
                    <p style="font-size: 11px; color: #666; margin-top: 5px;">
                        üí° Type to search from cached users/groups, or enter email/Object ID directly
                    </p>
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <select id="newUserRole">
                        <option value="Viewer">Viewer</option>
                        <option value="Contributor">Contributor</option>
                        <option value="Member">Member</option>
                        <option value="Admin">Admin</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Type</label>
                    <select id="newUserType">
                        <option value="User">User</option>
                        <option value="Group">Group</option>
                        <option value="App">App</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="closeAddUserModal()" class="button-secondary">Cancel</button>
                <button onclick="addUser()" class="button-success">Add</button>
            </div>
        </div>
    </div>
    
    <!-- Add Workspace Access Modal -->
    <div class="modal" id="addWorkspaceAccessModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2>‚ûï Add Workspace Access for <span id="modalUserName"></span></h2>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Search Workspaces</label>
                    <input type="text" id="workspaceSearchInput" 
                           placeholder="Type to filter..." oninput="filterAvailableWorkspaces()">
                </div>
                <div class="form-group">
                    <label>Available Workspaces</label>
                    <div id="availableWorkspacesList" style="max-height: 300px; overflow-y: auto; 
                         border: 1px solid #e0e0e0; border-radius: 6px; padding: 10px;">
                        Loading...
                    </div>
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <select id="bulkWorkspaceRole">
                        <option value="Viewer">Viewer</option>
                        <option value="Contributor">Contributor</option>
                        <option value="Member">Member</option>
                        <option value="Admin">Admin</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="closeAddWorkspaceAccessModal()" class="button-secondary">Cancel</button>
                <button onclick="addUserToSelectedWorkspaces()" class="button-success">Add to Selected</button>
            </div>
        </div>
    </div>

    <!-- External JavaScript Modules -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/dom.js"></script>
    <script src="js/cache.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/workspace.js"></script>
    <script src="js/user.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/app.js"></script>

    <!-- JSZip Library for creating ZIP files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <!-- Backup Module -->
    <script src="js/backup.js"></script>

    <script>
        // Legacy placeholder - all functionality moved to external modules
        // All JavaScript has been extracted to modular files in the js/ directory
    </script>
</body>
</html>
